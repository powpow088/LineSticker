<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINE 貼圖裁切工具</title>
    <meta name="description" content="LINE 貼圖裁切：上傳網格圖，自動切割成獨立貼圖">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="image-processor.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-container processor-container">
        <!-- Header -->
        <header class="app-header">
            <h1>✂️ LINE 貼圖裁切工具</h1>
            <p class="subtitle">上傳網格圖 · 去背裁切 · 打包下載</p>
            <nav class="header-nav">
                <a href="index.html" class="btn btn-primary">← 📝 Prompt 產生器</a>
            </nav>
        </header>

        <!-- Main Content -->
        <main class="processor-main">
            <!-- Step 1: Upload -->
            <section id="step1" class="step-section active">
                <div class="step-header">
                    <span class="step-number">1</span>
                    <h2>上傳網格圖片</h2>
                </div>
                <div class="upload-zone" id="uploadZone">
                    <div class="upload-content">
                        <span class="upload-icon">📁</span>
                        <p class="upload-text">拖放圖片到此處</p>
                        <p class="upload-hint">支援 AI 生成的貼圖網格圖</p>
                        <input type="file" id="fileInput" accept="image/*" class="file-input">
                    </div>
                </div>
            </section>

            <!-- Step 2: Grid Setup & Preview -->
            <section id="step2" class="step-section">
                <div class="step-header">
                    <span class="step-number">2</span>
                    <h2>設定裁切網格</h2>
                </div>

                <!-- Grid Settings -->
                <div class="grid-settings">
                    <div class="setting-row">
                        <label>網格大小：</label>
                        <select id="gridCols" class="select-input select-small">
                            <option value="1">1 欄</option>
                            <option value="2">2 欄</option>
                            <option value="3" selected>3 欄</option>
                            <option value="4">4 欄</option>
                            <option value="5">5 欄</option>
                            <option value="6">6 欄</option>
                        </select>
                        <span>×</span>
                        <select id="gridRows" class="select-input select-small">
                            <option value="1">1 列</option>
                            <option value="2">2 列</option>
                            <option value="3" selected>3 列</option>
                            <option value="4">4 列</option>
                            <option value="5">5 列</option>
                            <option value="6">6 列</option>
                        </select>
                    </div>

                </div>

                <!-- Tool Mode -->
                <div class="setting-row" id="toolModeSetting">
                    <label>工具：</label>
                    <label style="margin-right: 10px;">
                        <input type="radio" name="toolMode" value="wand" checked> 🪄 魔法棒
                    </label>
                    <label>
                        <input type="radio" name="toolMode" value="eraser"> ⬜ 框選清除
                    </label>
                </div>

                <!-- De-back Tolerance -->
                <div class="setting-row" id="toleranceSetting">
                    <label>去背容許度: <span id="toleranceValue">60</span></label>
                    <input type="range" id="toleranceRange" min="10" max="150" value="60"
                        style="width: 120px; vertical-align: middle;">
                </div>

                <div class="setting-row">
                    <label>微調位置：</label>
                    <button id="moveLeft" class="btn btn-icon-only">←</button>
                    <button id="moveRight" class="btn btn-icon-only">→</button>
                    <button id="moveUp" class="btn btn-icon-only">↑</button>
                    <button id="moveDown" class="btn btn-icon-only">↓</button>
                    <!-- Undo Button -->
                    <button id="undoBtn" class="btn btn-icon-only" title="復原 (Undo)">↶</button>
                </div>

                <!-- Legacy Mode & Preview -->
                <div class="setting-row">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="legacyModeToggle" style="margin-right: 4px;"> 經典綠幕
                    </label>
                    <button id="previewDebackBtn" class="btn btn-secondary" title="預覽去背效果">
                        <span class="btn-icon">👁️</span> 試看去背
                    </button>
                </div>




                <!-- Canvas with Grid Overlay -->
                <div class="grid-preview-container">
                    <div class="canvas-wrapper" id="canvasWrapper">
                        <canvas id="previewCanvas"></canvas>
                        <div class="grid-overlay" id="gridOverlay">
                            <!-- Grid lines generated by JS -->
                        </div>
                    </div>
                </div>

                <div class="step-footer">
                    <button id="backToUpload" class="btn btn-secondary">
                        <span class="btn-icon">←</span> 重新上傳
                    </button>
                    <button id="cutBtn" class="btn btn-primary btn-lg">
                        <span class="btn-icon">✂️</span> 裁切並下載 ZIP
                    </button>
                </div>
            </section>

            <!-- Step 3: Complete -->
            <section id="step3" class="step-section">
                <div class="step-header">
                    <span class="step-number">✓</span>
                    <h2>裁切完成！</h2>
                </div>
                <div class="complete-area">
                    <div class="complete-icon">🎉</div>
                    <p class="complete-text">已成功裁切 <span id="cutCount">0</span> 張貼圖</p>
                    <p class="complete-hint">ZIP 檔案已下載到您的下載資料夾</p>

                    <!-- Main Image Selection -->
                    <div class="main-select-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" id="enableMainSelect">
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="toggle-text">手動選擇主圖</span>
                        <span class="toggle-hint" id="mainSelectHint">（目前使用第一張）</span>
                    </div>

                    <p id="mainSelectInstruction" class="select-instruction hidden">👆 點擊下方貼圖選擇作為主圖</p>

                    <div class="preview-grid-small" id="resultPreview">
                        <!-- Cut stickers preview -->
                    </div>

                    <!-- Re-download button -->
                    <button id="redownloadBtn" class="btn btn-secondary hidden" style="margin-top: 16px;">
                        <span class="btn-icon">📦</span> 重新下載 ZIP（含新主圖）
                    </button>
                </div>
                <div class="step-footer">
                    <button id="startOverBtn" class="btn btn-primary">
                        <span class="btn-icon">🔄</span> 處理另一張圖片
                    </button>
                </div>
            </section>
        </main>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <script src="image-processor.js"></script>
</body>

</html>