/* =========================================
   LINE è²¼åœ–è£åˆ‡å·¥å…· - æ¨£å¼è¡¨
   ========================================= */

/* Processor Container */
.processor-container {
    max-width: 1200px;
}

.processor-main {
    display: flex;
    flex-direction: column;
    gap: 24px;
}

/* Header Nav */
.header-nav {
    margin-top: 12px;
}

.nav-link {
    color: var(--primary);
    text-decoration: none;
    font-size: 0.9rem;
    transition: opacity 0.2s;
}

.nav-link:hover {
    opacity: 0.8;
}

/* Step Sections */
.step-section {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
    padding: 24px;
    display: none;
}

.step-section.active {
    display: block;
}

.step-header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.step-number {
    width: 36px;
    height: 36px;
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.1rem;
}

/* Background Mode Toggle */
.bg-mode-row {
    margin-top: 8px;
    padding-top: 12px;
    border-top: 1px solid var(--border);
}

.toggle-group {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
}

.toggle-option {
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
}

.toggle-option input[type="radio"] {
    width: 18px;
    height: 18px;
    accent-color: var(--primary);
}

.toggle-label {
    font-weight: 500;
    font-size: 0.95rem;
}

.green-label {
    color: #22c55e;
}

.ai-label {
    color: #8b5cf6;
}

.toggle-hint {
    font-size: 0.8rem;
    color: var(--text-muted);
}

.step-header h2 {
    font-size: 1.25rem;
    font-weight: 600;
    flex: 1;
}

.step-footer {
    display: flex;
    justify-content: center;
    gap: 16px;
    margin-top: 24px;
    padding-top: 20px;
    border-top: 1px solid var(--border);
}

/* Upload Zone */
.upload-zone {
    border: 3px dashed var(--border);
    border-radius: var(--radius-lg);
    padding: 60px 40px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: var(--bg-input);
}

.upload-zone:hover,
.upload-zone.dragover {
    border-color: var(--primary);
    background: var(--primary-light);
}

.upload-content {
    pointer-events: none;
}

.upload-icon {
    font-size: 4rem;
    display: block;
    margin-bottom: 16px;
}

.upload-text {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 8px;
}

.upload-hint {
    color: var(--text-secondary);
    font-size: 0.95rem;
}

.file-input {
    display: none;
}

/* Grid Settings */
.grid-settings {
    background: var(--bg-input);
    border-radius: var(--radius-md);
    padding: 16px 20px;
    margin-bottom: 20px;
}

.setting-row {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
    margin-bottom: 12px;
}

.setting-row:last-child {
    margin-bottom: 0;
}

.setting-row label {
    font-weight: 500;
    min-width: 80px;
    flex-shrink: 0;
}

.setting-row span {
    color: var(--text-secondary);
}

/* Make select smaller for grid size */
.select-small {
    width: auto;
    min-width: 80px;
    padding: 8px 12px;
}

.grid-total {
    font-weight: 600;
    color: var(--primary);
    margin-left: 8px;
}

.offset-display {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-left: 12px;
}

.btn-icon-only {
    width: 36px;
    height: 36px;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-size: 1rem;
    transition: all 0.2s;
}

.btn-icon-only:hover {
    background: var(--primary-light);
    border-color: var(--primary);
}

/* Grid Preview */
.grid-preview-container {
    display: flex;
    justify-content: center;
    padding: 20px;
    background: repeating-conic-gradient(#e0e0e0 0% 25%, #f5f5f5 0% 50%) 50% / 20px 20px;
    border-radius: var(--radius-md);
    overflow: auto;
    max-height: 70vh;
}

.canvas-wrapper {
    position: relative;
    display: inline-block;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
}

#previewCanvas {
    display: block;
    max-width: 100%;
    height: auto;
}

.grid-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.grid-line-v,
.grid-line-h {
    position: absolute;
    background: rgba(255, 0, 0, 0.7);
}

.grid-line-v {
    width: 2px;
    height: 100%;
    top: 0;
}

.grid-line-h {
    height: 2px;
    width: 100%;
    left: 0;
}

.grid-border {
    position: absolute;
    border: 3px solid rgba(255, 0, 0, 0.9);
    box-sizing: border-box;
    pointer-events: none;
}

.grid-cell-number {
    position: absolute;
    background: rgba(255, 0, 0, 0.85);
    color: white;
    font-size: 12px;
    font-weight: bold;
    padding: 2px 6px;
    border-radius: 3px;
    pointer-events: none;
}

/* Complete Area */
.complete-area {
    text-align: center;
    padding: 40px 20px;
}

.complete-icon {
    font-size: 4rem;
    margin-bottom: 16px;
}

.complete-text {
    font-size: 1.3rem;
    font-weight: 600;
    margin-bottom: 8px;
}

.complete-text span {
    color: var(--primary);
}

.complete-hint {
    color: var(--text-secondary);
    margin-bottom: 24px;
}

.preview-grid-small {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    gap: 8px;
    max-width: 600px;
    margin: 0 auto;
}

.preview-grid-small img {
    width: 100%;
    aspect-ratio: 370 / 320;
    object-fit: contain;
    background: white;
    border-radius: 6px;
    border: 1px solid var(--border);
}

/* Toast */
.toast {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--text-primary);
    color: white;
    padding: 14px 24px;
    border-radius: var(--radius-md);
    font-size: 0.9rem;
    font-weight: 500;
    box-shadow: var(--shadow-lg);
    z-index: 1000;
    opacity: 0;
    transition: all 0.3s ease;
}

.toast.show {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
}

.toast.success {
    background: var(--primary);
}

.toast.error {
    background: #e53e3e;
}

/* Button Variants */
.btn-sm {
    padding: 6px 12px;
    font-size: 0.85rem;
}

.btn-lg {
    padding: 14px 28px;
    font-size: 1rem;
}

/* Responsive */
@media (max-width: 600px) {
    .setting-row {
        flex-wrap: nowrap;
        overflow-x: auto;
        gap: 8px;
    }

    .setting-row label {
        min-width: 70px;
        font-size: 0.9rem;
    }

    .select-small {
        min-width: 65px;
        padding: 6px 8px;
        font-size: 0.85rem;
    }

    .btn-icon-only {
        width: 32px;
        height: 32px;
        font-size: 0.9rem;
    }

    .offset-display {
        margin-left: 4px;
        font-size: 0.75rem;
        white-space: nowrap;
    }

    .grid-total {
        font-size: 0.85rem;
        margin-left: 4px;
        white-space: nowrap;
    }

    .step-footer {
        flex-direction: column;
    }

    .toggle-hint {
        display: none;
    }
}

/* Main Image Selection */
.main-select-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin: 20px 0;
}

.toggle-switch {
    position: relative;
    width: 48px;
    height: 26px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: 0.3s;
    border-radius: 26px;
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: 0.3s;
    border-radius: 50%;
}

.toggle-switch input:checked+.toggle-slider {
    background-color: var(--primary);
}

.toggle-switch input:checked+.toggle-slider:before {
    transform: translateX(22px);
}

.toggle-text {
    font-weight: 500;
}

.select-instruction {
    color: var(--primary);
    font-weight: 500;
    margin-bottom: 12px;
    animation: pulse 1.5s infinite;
}

@keyframes pulse {

    0%,
    100% {
        opacity: 1;
    }

    50% {
        opacity: 0.6;
    }
}

.preview-grid-small img.selectable {
    cursor: pointer;
    transition: all 0.2s;
}

.preview-grid-small img.selectable:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(6, 199, 85, 0.3);
}

.preview-grid-small img.selected {
    border: 3px solid var(--primary);
    box-shadow: 0 0 0 3px var(--primary-light);
}

<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINE è²¼åœ–è£åˆ‡å·¥å…·</title>
    <meta name="description" content="LINE è²¼åœ–è£åˆ‡ï¼šä¸Šå‚³ç¶²æ ¼åœ–ï¼Œè‡ªå‹•åˆ‡å‰²æˆç¨ç«‹è²¼åœ–">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="image-processor.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-container processor-container">
        <!-- Header -->
        <header class="app-header">
            <h1>âœ‚ï¸ LINE è²¼åœ–è£åˆ‡å·¥å…·</h1>
            <p class="subtitle">ä¸Šå‚³ç¶²æ ¼åœ– Â· å»èƒŒè£åˆ‡ Â· æ‰“åŒ…ä¸‹è¼‰</p>
            <nav class="header-nav">
                <a href="index.html" class="btn btn-primary">â† ğŸ“ Prompt ç”¢ç”Ÿå™¨</a>
            </nav>
        </header>

        <!-- Main Content -->
        <main class="processor-main">
            <!-- Step 1: Upload -->
            <section id="step1" class="step-section active">
                <div class="step-header">
                    <span class="step-number">1</span>
                    <h2>ä¸Šå‚³ç¶²æ ¼åœ–ç‰‡</h2>
                </div>
                <div class="upload-zone" id="uploadZone">
                    <div class="upload-content">
                        <span class="upload-icon">ğŸ“</span>
                        <p class="upload-text">æ‹–æ”¾åœ–ç‰‡åˆ°æ­¤è™•</p>
                        <p class="upload-hint">æ”¯æ´ AI ç”Ÿæˆçš„è²¼åœ–ç¶²æ ¼åœ–</p>
                        <input type="file" id="fileInput" accept="image/*" class="file-input">
                    </div>
                </div>
            </section>

            <!-- Step 2: Grid Setup & Preview -->
            <section id="step2" class="step-section">
                <div class="step-header">
                    <span class="step-number">2</span>
                    <h2>è¨­å®šè£åˆ‡ç¶²æ ¼</h2>
                </div>

                <!-- Grid Settings -->
                <div class="grid-settings">
                    <div class="setting-row">
                        <label>ç¶²æ ¼å¤§å°ï¼š</label>
                        <select id="gridCols" class="select-input select-small">
                            <option value="1">1 æ¬„</option>
                            <option value="2">2 æ¬„</option>
                            <option value="3" selected>3 æ¬„</option>
                            <option value="4">4 æ¬„</option>
                            <option value="5">5 æ¬„</option>
                            <option value="6">6 æ¬„</option>
                        </select>
                        <span>Ã—</span>
                        <select id="gridRows" class="select-input select-small">
                            <option value="1">1 åˆ—</option>
                            <option value="2">2 åˆ—</option>
                            <option value="3" selected>3 åˆ—</option>
                            <option value="4">4 åˆ—</option>
                            <option value="5">5 åˆ—</option>
                            <option value="6">6 åˆ—</option>
                        </select>
                        <span class="grid-total" id="gridTotal">= 9 å¼µè²¼åœ–</span>
                    </div>
                    <div class="setting-row">
                        <label>å¾®èª¿ä½ç½®ï¼š</label>
                        <button id="moveLeft" class="btn btn-icon-only">â†</button>
                        <button id="moveRight" class="btn btn-icon-only">â†’</button>
                        <button id="moveUp" class="btn btn-icon-only">â†‘</button>
                        <button id="moveDown" class="btn btn-icon-only">â†“</button>
                        <span class="offset-display" id="offsetDisplay">åç§»: (0, 0)</span>
                        <button id="resetOffset" class="btn btn-ghost btn-sm">é‡è¨­</button>
                    </div>
                </div>

                <!-- Canvas with Grid Overlay -->
                <div class="grid-preview-container">
                    <div class="canvas-wrapper" id="canvasWrapper">
                        <canvas id="previewCanvas"></canvas>
                        <div class="grid-overlay" id="gridOverlay">
                            <!-- Grid lines generated by JS -->
                        </div>
                    </div>
                </div>

                <div class="step-footer">
                    <button id="backToUpload" class="btn btn-secondary">
                        <span class="btn-icon">â†</span> é‡æ–°ä¸Šå‚³
                    </button>
                    <button id="cutBtn" class="btn btn-primary btn-lg">
                        <span class="btn-icon">âœ‚ï¸</span> è£åˆ‡ä¸¦ä¸‹è¼‰ ZIP
                    </button>
                </div>
            </section>

            <!-- Step 3: Complete -->
            <section id="step3" class="step-section">
                <div class="step-header">
                    <span class="step-number">âœ“</span>
                    <h2>è£åˆ‡å®Œæˆï¼</h2>
                </div>
                <div class="complete-area">
                    <div class="complete-icon">ğŸ‰</div>
                    <p class="complete-text">å·²æˆåŠŸè£åˆ‡ <span id="cutCount">0</span> å¼µè²¼åœ–</p>
                    <p class="complete-hint">ZIP æª”æ¡ˆå·²ä¸‹è¼‰åˆ°æ‚¨çš„ä¸‹è¼‰è³‡æ–™å¤¾</p>

                    <!-- Main Image Selection -->
                    <div class="main-select-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" id="enableMainSelect">
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="toggle-text">æ‰‹å‹•é¸æ“‡ä¸»åœ–</span>
                        <span class="toggle-hint" id="mainSelectHint">ï¼ˆç›®å‰ä½¿ç”¨ç¬¬ä¸€å¼µï¼‰</span>
                    </div>

                    <p id="mainSelectInstruction" class="select-instruction hidden">ğŸ‘† é»æ“Šä¸‹æ–¹è²¼åœ–é¸æ“‡ä½œç‚ºä¸»åœ–</p>

                    <div class="preview-grid-small" id="resultPreview">
                        <!-- Cut stickers preview -->
                    </div>

                    <!-- Re-download button -->
                    <button id="redownloadBtn" class="btn btn-secondary hidden" style="margin-top: 16px;">
                        <span class="btn-icon">ğŸ“¦</span> é‡æ–°ä¸‹è¼‰ ZIPï¼ˆå«æ–°ä¸»åœ–ï¼‰
                    </button>
                </div>
                <div class="step-footer">
                    <button id="startOverBtn" class="btn btn-primary">
                        <span class="btn-icon">ğŸ”„</span> è™•ç†å¦ä¸€å¼µåœ–ç‰‡
                    </button>
                </div>
            </section>
        </main>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <script src="image-processor.js"></script>
</body>

</html>


// =========================================
// LINE è²¼åœ–è£åˆ‡å·¥å…· - ä¸»ç¨‹å¼
// =========================================

// LINE Sticker Specifications
const STICKER_WIDTH = 370;
const STICKER_HEIGHT = 320;

// State
let uploadedImage = null;
let imageElement = null;
let gridCols = 3;
let gridRows = 3;
let offsetX = 0;
let offsetY = 0;
let scale = 1;
let cutStickers = [];
let selectedMainIndex = 0; // Index of sticker to use as main.png

// DOM Elements
const elements = {
    // Steps
    step1: document.getElementById('step1'),
    step2: document.getElementById('step2'),
    step3: document.getElementById('step3'),

    // Upload
    uploadZone: document.getElementById('uploadZone'),
    fileInput: document.getElementById('fileInput'),

    // Grid Settings
    gridCols: document.getElementById('gridCols'),
    gridRows: document.getElementById('gridRows'),
    gridTotal: document.getElementById('gridTotal'),
    moveLeft: document.getElementById('moveLeft'),
    moveRight: document.getElementById('moveRight'),
    moveUp: document.getElementById('moveUp'),
    moveDown: document.getElementById('moveDown'),
    offsetDisplay: document.getElementById('offsetDisplay'),
    resetOffset: document.getElementById('resetOffset'),

    // Preview
    canvasWrapper: document.getElementById('canvasWrapper'),
    previewCanvas: document.getElementById('previewCanvas'),
    gridOverlay: document.getElementById('gridOverlay'),

    // Actions
    backToUpload: document.getElementById('backToUpload'),
    cutBtn: document.getElementById('cutBtn'),
    startOverBtn: document.getElementById('startOverBtn'),

    // Results
    cutCount: document.getElementById('cutCount'),
    resultPreview: document.getElementById('resultPreview'),

    // Main Image Selection
    enableMainSelect: document.getElementById('enableMainSelect'),
    mainSelectHint: document.getElementById('mainSelectHint'),
    mainSelectInstruction: document.getElementById('mainSelectInstruction'),
    redownloadBtn: document.getElementById('redownloadBtn'),

    // Toast
    toast: document.getElementById('toast')
};

// =========================================
// Initialization
// =========================================

function init() {
    bindEvents();
}

function bindEvents() {
    // Upload Zone
    elements.uploadZone.addEventListener('click', () => elements.fileInput.click());
    elements.uploadZone.addEventListener('dragover', handleDragOver);
    elements.uploadZone.addEventListener('dragleave', handleDragLeave);
    elements.uploadZone.addEventListener('drop', handleDrop);
    elements.fileInput.addEventListener('change', handleFileSelect);

    // Grid Settings
    elements.gridCols.addEventListener('change', updateGridSettings);
    elements.gridRows.addEventListener('change', updateGridSettings);

    // Position Controls
    elements.moveLeft.addEventListener('click', () => moveGrid(-10, 0));
    elements.moveRight.addEventListener('click', () => moveGrid(10, 0));
    elements.moveUp.addEventListener('click', () => moveGrid(0, -10));
    elements.moveDown.addEventListener('click', () => moveGrid(0, 10));
    elements.resetOffset.addEventListener('click', resetGridOffset);

    // Actions
    elements.backToUpload.addEventListener('click', () => {
        showStep(1);
        resetAll();
    });
    elements.cutBtn.addEventListener('click', cutAndDownload);
    elements.startOverBtn.addEventListener('click', () => {
        showStep(1);
        resetAll();
    });

    // Main Image Selection
    elements.enableMainSelect.addEventListener('change', toggleMainSelect);
    elements.redownloadBtn.addEventListener('click', redownloadWithNewMain);
}

// =========================================
// File Upload Handlers
// =========================================

function handleDragOver(e) {
    e.preventDefault();
    e.stopPropagation();
    elements.uploadZone.classList.add('dragover');
}

function handleDragLeave(e) {
    e.preventDefault();
    e.stopPropagation();
    elements.uploadZone.classList.remove('dragover');
}

function handleDrop(e) {
    e.preventDefault();
    e.stopPropagation();
    elements.uploadZone.classList.remove('dragover');

    const files = e.dataTransfer.files;
    if (files.length > 0 && files[0].type.startsWith('image/')) {
        loadImage(files[0]);
    }
}

function handleFileSelect(e) {
    const files = e.target.files;
    if (files.length > 0) {
        loadImage(files[0]);
    }
    e.target.value = '';
}

function loadImage(file) {
    const reader = new FileReader();
    reader.onload = (e) => {
        uploadedImage = e.target.result;
        imageElement = new Image();
        imageElement.onload = () => {
            // Auto-detect grid size based on image aspect ratio
            autoDetectGridSize();
            showStep(2);
            drawPreview();
        };
        imageElement.src = uploadedImage;
    };
    reader.readAsDataURL(file);
}

// =========================================
// Grid Detection & Settings
// =========================================

function autoDetectGridSize() {
    if (!imageElement) return;

    const imgRatio = imageElement.width / imageElement.height;
    const stickerRatio = STICKER_WIDTH / STICKER_HEIGHT;

    // Try common grid sizes and find best match
    const gridOptions = [
        [1, 1], [2, 2], [3, 2], [3, 3], [4, 2], [4, 3], [4, 4],
        [5, 3], [5, 4], [6, 4], [5, 5], [6, 5], [6, 6]
    ];

    let bestMatch = [3, 3];
    let bestDiff = Infinity;

    for (const [cols, rows] of gridOptions) {
        const gridRatio = (cols * STICKER_WIDTH) / (rows * STICKER_HEIGHT);
        const diff = Math.abs(gridRatio - imgRatio);
        if (diff < bestDiff) {
            bestDiff = diff;
            bestMatch = [cols, rows];
        }
    }

    gridCols = bestMatch[0];
    gridRows = bestMatch[1];
    elements.gridCols.value = gridCols;
    elements.gridRows.value = gridRows;
    updateGridTotal();
}

function updateGridSettings() {
    gridCols = parseInt(elements.gridCols.value);
    gridRows = parseInt(elements.gridRows.value);
    updateGridTotal();
    drawPreview();
}

function updateGridTotal() {
    const total = gridCols * gridRows;
    elements.gridTotal.textContent = `= ${total} å¼µè²¼åœ–`;
}

function moveGrid(dx, dy) {
    offsetX += dx;
    offsetY += dy;
    updateOffsetDisplay();
    drawGridOverlay();
}

function resetGridOffset() {
    offsetX = 0;
    offsetY = 0;
    updateOffsetDisplay();
    drawGridOverlay();
}

function updateOffsetDisplay() {
    elements.offsetDisplay.textContent = `åç§»: (${offsetX}, ${offsetY})`;
}

// =========================================
// Preview Drawing
// =========================================

function drawPreview() {
    if (!imageElement) return;

    const canvas = elements.previewCanvas;
    const ctx = canvas.getContext('2d');

    // Set canvas size to match image (scaled down if too large)
    const maxWidth = 900;
    scale = Math.min(1, maxWidth / imageElement.width);

    canvas.width = imageElement.width * scale;
    canvas.height = imageElement.height * scale;

    // Draw image
    ctx.drawImage(imageElement, 0, 0, canvas.width, canvas.height);

    // Draw grid overlay
    drawGridOverlay();
}

function drawGridOverlay() {
    const overlay = elements.gridOverlay;
    overlay.innerHTML = '';

    // Use percentage-based positioning for responsive display
    const cellWidthPercent = 100 / gridCols;
    const cellHeightPercent = 100 / gridRows;

    // Offset as percentage of canvas
    const canvas = elements.previewCanvas;
    const offsetXPercent = (offsetX / (canvas.width / scale)) * 100;
    const offsetYPercent = (offsetY / (canvas.height / scale)) * 100;

    // Draw outer border
    const border = document.createElement('div');
    border.className = 'grid-border';
    border.style.left = offsetXPercent + '%';
    border.style.top = offsetYPercent + '%';
    border.style.width = '100%';
    border.style.height = '100%';
    overlay.appendChild(border);

    // Draw vertical lines
    for (let i = 1; i < gridCols; i++) {
        const line = document.createElement('div');
        line.className = 'grid-line-v';
        line.style.left = (i * cellWidthPercent + offsetXPercent) + '%';
        overlay.appendChild(line);
    }

    // Draw horizontal lines
    for (let i = 1; i < gridRows; i++) {
        const line = document.createElement('div');
        line.className = 'grid-line-h';
        line.style.top = (i * cellHeightPercent + offsetYPercent) + '%';
        overlay.appendChild(line);
    }

    // Draw cell numbers
    for (let row = 0; row < gridRows; row++) {
        for (let col = 0; col < gridCols; col++) {
            const num = row * gridCols + col + 1;
            const label = document.createElement('div');
            label.className = 'grid-cell-number';
            label.textContent = num;
            label.style.left = (col * cellWidthPercent + offsetXPercent + 1) + '%';
            label.style.top = (row * cellHeightPercent + offsetYPercent + 1) + '%';
            overlay.appendChild(label);
        }
    }
}

// =========================================
// Cut and Download
// =========================================

async function cutAndDownload() {
    if (!imageElement) return;

    const totalStickers = gridCols * gridRows;
    showToast(`æ­£åœ¨è™•ç† ${totalStickers} å¼µè²¼åœ–...`, 'success');
    cutStickers = [];

    // Calculate actual cell size from original image
    const cellWidth = imageElement.width / gridCols;
    const cellHeight = imageElement.height / gridRows;

    const zip = new JSZip();
    const folder = zip.folder('LINE_Stickers');

    // Cut each cell
    for (let row = 0; row < gridRows; row++) {
        for (let col = 0; col < gridCols; col++) {
            const num = row * gridCols + col + 1;
            showToast(`å»èƒŒä¸­... (${num}/${totalStickers})`, 'success');

            // Create temp canvas to crop this cell
            const cropCanvas = document.createElement('canvas');
            cropCanvas.width = cellWidth;
            cropCanvas.height = cellHeight;
            const cropCtx = cropCanvas.getContext('2d');

            // Source position (with offset)
            const srcX = col * cellWidth + offsetX / scale;
            const srcY = row * cellHeight + offsetY / scale;

            // Draw cropped portion
            cropCtx.drawImage(
                imageElement,
                srcX, srcY, cellWidth, cellHeight,
                0, 0, cellWidth, cellHeight
            );

            // Remove green background
            const resultBlob = await chromaKeyRemoval(cropCanvas);

            // Create final sticker canvas (370x320)
            const stickerCanvas = document.createElement('canvas');
            stickerCanvas.width = STICKER_WIDTH;
            stickerCanvas.height = STICKER_HEIGHT;
            const stickerCtx = stickerCanvas.getContext('2d');

            // Load result and draw scaled to sticker size
            const resultImg = await loadImageFromBlob(resultBlob);
            stickerCtx.drawImage(resultImg, 0, 0, STICKER_WIDTH, STICKER_HEIGHT);

            // Convert to blob and add to ZIP
            const finalBlob = await new Promise(resolve => {
                stickerCanvas.toBlob(resolve, 'image/png');
            });

            const filename = `${String(num).padStart(2, '0')}.png`;
            folder.file(filename, finalBlob);

            // Save for preview
            cutStickers.push({
                num: num,
                dataUrl: stickerCanvas.toDataURL('image/png')
            });
        }
    }

    // Generate main.png (240x240) - using first sticker
    if (cutStickers.length > 0) {
        const mainCanvas = document.createElement('canvas');
        mainCanvas.width = 240;
        mainCanvas.height = 240;
        const mainCtx = mainCanvas.getContext('2d');

        const firstImg = new Image();
        firstImg.src = cutStickers[0].dataUrl;
        await new Promise(resolve => { firstImg.onload = resolve; });

        // Center and fit the sticker in square
        const scale = Math.min(240 / STICKER_WIDTH, 240 / STICKER_HEIGHT);
        const w = STICKER_WIDTH * scale;
        const h = STICKER_HEIGHT * scale;
        const x = (240 - w) / 2;
        const y = (240 - h) / 2;
        mainCtx.drawImage(firstImg, x, y, w, h);

        const mainBlob = await new Promise(resolve => {
            mainCanvas.toBlob(resolve, 'image/png');
        });
        folder.file('main.png', mainBlob);
    }

    // Generate tab.png (96x74) - using first sticker
    if (cutStickers.length > 0) {
        const tabCanvas = document.createElement('canvas');
        tabCanvas.width = 96;
        tabCanvas.height = 74;
        const tabCtx = tabCanvas.getContext('2d');

        const firstImg = new Image();
        firstImg.src = cutStickers[0].dataUrl;
        await new Promise(resolve => { firstImg.onload = resolve; });

        // Center and fit the sticker
        const scale = Math.min(96 / STICKER_WIDTH, 74 / STICKER_HEIGHT);
        const w = STICKER_WIDTH * scale;
        const h = STICKER_HEIGHT * scale;
        const x = (96 - w) / 2;
        const y = (74 - h) / 2;
        tabCtx.drawImage(firstImg, x, y, w, h);

        const tabBlob = await new Promise(resolve => {
            tabCanvas.toBlob(resolve, 'image/png');
        });
        folder.file('tab.png', tabBlob);
    }

    // Add readme
    const readme = `LINE è²¼åœ–ä¸Šå‚³èªªæ˜
==================

æª”æ¡ˆæ¸…å–®:
- main.png (240x240) - è²¼åœ–é¦–é åœ–ç¤º
- tab.png (96x74) - èŠå¤©å®¤é¸å–®åœ–ç¤º
- 01.png ~ ${String(gridCols * gridRows).padStart(2, '0')}.png - è²¼åœ– (${STICKER_WIDTH}x${STICKER_HEIGHT})

ä¸Šå‚³æ­¥é©Ÿ:
1. å‰å¾€ LINE Creators Market (https://creator.line.me/)
2. ç™»å…¥ä¸¦å»ºç«‹æ–°è²¼åœ–
3. ä¸Šå‚³ main.png ä½œç‚ºä¸»åœ–
4. ä¸Šå‚³ tab.png ä½œç‚ºæ¨™ç±¤åœ–
5. ä¸Šå‚³æ‰€æœ‰ç·¨è™Ÿ PNG ä½œç‚ºè²¼åœ–
6. å¡«å¯«è³‡è¨Šä¸¦é€å¯©

ç”¢ç”Ÿæ™‚é–“: ${new Date().toLocaleString('zh-TW')}
`;
    folder.file('èªªæ˜.txt', readme);

    // Generate and download ZIP
    const content = await zip.generateAsync({ type: 'blob' });
    const filename = `LINE_Stickers_${gridCols}x${gridRows}_${new Date().toISOString().slice(0, 10)}.zip`;

    saveAs(content, filename);

    // Show results
    showResults();
}

// =========================================
// Chroma Key (Green Screen) Removal
// =========================================

async function chromaKeyRemoval(canvas) {
    const ctx = canvas.getContext('2d');
    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    const data = imageData.data;

    // Green screen color range
    // Target: green hue (around 100-140), high saturation
    for (let i = 0; i < data.length; i += 4) {
        const r = data[i];
        const g = data[i + 1];
        const b = data[i + 2];

        // Check if pixel is green-ish
        // Green should be dominant and significantly higher than red/blue
        const isGreen = g > 80 &&
            g > r * 1.2 &&
            g > b * 1.2 &&
            Math.abs(r - b) < 80;

        if (isGreen) {
            data[i + 3] = 0; // Make transparent
        }
    }

    ctx.putImageData(imageData, 0, 0);

    return new Promise(resolve => {
        canvas.toBlob(resolve, 'image/png');
    });
}


function loadImageFromBlob(blob) {
    return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => resolve(img);
        img.onerror = reject;
        img.src = URL.createObjectURL(blob);
    });
}


function showResults() {
    elements.cutCount.textContent = cutStickers.length;
    selectedMainIndex = 0; // Reset to first sticker
    elements.enableMainSelect.checked = false;
    elements.redownloadBtn.classList.add('hidden');
    elements.mainSelectInstruction.classList.add('hidden');
    elements.mainSelectHint.textContent = 'ï¼ˆç›®å‰ä½¿ç”¨ç¬¬ä¸€å¼µï¼‰';

    // Generate preview grid
    elements.resultPreview.innerHTML = '';
    cutStickers.forEach((sticker, index) => {
        const img = document.createElement('img');
        img.src = sticker.dataUrl;
        img.alt = `Sticker ${sticker.num}`;
        img.title = `è²¼åœ– ${sticker.num}`;
        img.dataset.index = index;
        if (index === 0) img.classList.add('selected');
        elements.resultPreview.appendChild(img);
    });

    showStep(3);
    showToast('ZIP ä¸‹è¼‰å®Œæˆï¼', 'success');
}

function toggleMainSelect() {
    const enabled = elements.enableMainSelect.checked;
    const images = elements.resultPreview.querySelectorAll('img');

    if (enabled) {
        elements.mainSelectInstruction.classList.remove('hidden');
        images.forEach(img => {
            img.classList.add('selectable');
            img.addEventListener('click', selectMainSticker);
        });
    } else {
        elements.mainSelectInstruction.classList.add('hidden');
        images.forEach(img => {
            img.classList.remove('selectable');
            img.removeEventListener('click', selectMainSticker);
        });
    }
}

function selectMainSticker(e) {
    const index = parseInt(e.target.dataset.index);
    selectedMainIndex = index;

    // Update visual selection
    elements.resultPreview.querySelectorAll('img').forEach(img => {
        img.classList.remove('selected');
    });
    e.target.classList.add('selected');

    // Update hint and show re-download button
    elements.mainSelectHint.textContent = `ï¼ˆå·²é¸æ“‡ç¬¬ ${index + 1} å¼µï¼‰`;
    elements.redownloadBtn.classList.remove('hidden');

    showToast(`å·²é¸æ“‡ç¬¬ ${index + 1} å¼µä½œç‚ºä¸»åœ–`, 'success');
}

async function redownloadWithNewMain() {
    showToast('æ­£åœ¨ç”¢ç”Ÿæ–°çš„ ZIP...', 'success');

    const zip = new JSZip();
    const folder = zip.folder('LINE_Stickers');

    // Add all stickers
    for (const sticker of cutStickers) {
        const response = await fetch(sticker.dataUrl);
        const blob = await response.blob();
        const filename = `${String(sticker.num).padStart(2, '0')}.png`;
        folder.file(filename, blob);
    }

    // Generate main.png from selected sticker
    const mainCanvas = document.createElement('canvas');
    mainCanvas.width = 240;
    mainCanvas.height = 240;
    const mainCtx = mainCanvas.getContext('2d');

    const selectedImg = new Image();
    selectedImg.src = cutStickers[selectedMainIndex].dataUrl;
    await new Promise(resolve => { selectedImg.onload = resolve; });

    const scale = Math.min(240 / STICKER_WIDTH, 240 / STICKER_HEIGHT);
    const w = STICKER_WIDTH * scale;
    const h = STICKER_HEIGHT * scale;
    const x = (240 - w) / 2;
    const y = (240 - h) / 2;
    mainCtx.drawImage(selectedImg, x, y, w, h);

    const mainBlob = await new Promise(resolve => {
        mainCanvas.toBlob(resolve, 'image/png');
    });
    folder.file('main.png', mainBlob);

    // Generate tab.png from selected sticker
    const tabCanvas = document.createElement('canvas');
    tabCanvas.width = 96;
    tabCanvas.height = 74;
    const tabCtx = tabCanvas.getContext('2d');

    const tabScale = Math.min(96 / STICKER_WIDTH, 74 / STICKER_HEIGHT);
    const tw = STICKER_WIDTH * tabScale;
    const th = STICKER_HEIGHT * tabScale;
    const tx = (96 - tw) / 2;
    const ty = (74 - th) / 2;
    tabCtx.drawImage(selectedImg, tx, ty, tw, th);

    const tabBlob = await new Promise(resolve => {
        tabCanvas.toBlob(resolve, 'image/png');
    });
    folder.file('tab.png', tabBlob);

    // Add readme
    const readme = `LINE è²¼åœ–ä¸Šå‚³èªªæ˜
==================

æª”æ¡ˆæ¸…å–®:
- main.png (240x240) - è²¼åœ–é¦–é åœ–ç¤ºï¼ˆä½¿ç”¨ç¬¬ ${selectedMainIndex + 1} å¼µï¼‰
- tab.png (96x74) - èŠå¤©å®¤é¸å–®åœ–ç¤º
- 01.png ~ ${String(cutStickers.length).padStart(2, '0')}.png - è²¼åœ– (${STICKER_WIDTH}x${STICKER_HEIGHT})

ä¸Šå‚³æ­¥é©Ÿ:
1. å‰å¾€ LINE Creators Market (https://creator.line.me/)
2. ç™»å…¥ä¸¦å»ºç«‹æ–°è²¼åœ–
3. ä¸Šå‚³ main.png ä½œç‚ºä¸»åœ–
4. ä¸Šå‚³ tab.png ä½œç‚ºæ¨™ç±¤åœ–
5. ä¸Šå‚³æ‰€æœ‰ç·¨è™Ÿ PNG ä½œç‚ºè²¼åœ–
6. å¡«å¯«è³‡è¨Šä¸¦é€å¯©

ç”¢ç”Ÿæ™‚é–“: ${new Date().toLocaleString('zh-TW')}
`;
    folder.file('èªªæ˜.txt', readme);

    // Generate and download ZIP
    const content = await zip.generateAsync({ type: 'blob' });
    const filename = `LINE_Stickers_main${selectedMainIndex + 1}_${new Date().toISOString().slice(0, 10)}.zip`;

    saveAs(content, filename);
    showToast('æ–° ZIP ä¸‹è¼‰å®Œæˆï¼', 'success');
}

// =========================================
// UI Helpers
// =========================================

function showStep(stepNumber) {
    document.querySelectorAll('.step-section').forEach((section, index) => {
        section.classList.toggle('active', index + 1 === stepNumber);
    });
}

function resetAll() {
    uploadedImage = null;
    imageElement = null;
    gridCols = 3;
    gridRows = 3;
    offsetX = 0;
    offsetY = 0;
    cutStickers = [];
    elements.gridCols.value = '3';
    elements.gridRows.value = '3';
    updateGridTotal();
    updateOffsetDisplay();
    elements.previewCanvas.getContext('2d').clearRect(0, 0, elements.previewCanvas.width, elements.previewCanvas.height);
    elements.gridOverlay.innerHTML = '';
    elements.resultPreview.innerHTML = '';
}

function showToast(message, type = 'success') {
    elements.toast.textContent = message;
    elements.toast.className = `toast ${type}`;
    elements.toast.classList.remove('hidden');
    setTimeout(() => elements.toast.classList.add('show'), 10);
    setTimeout(() => {
        elements.toast.classList.remove('show');
        setTimeout(() => elements.toast.classList.add('hidden'), 300);
    }, 2500);
}

// =========================================
// Start App
// =========================================

document.addEventListener('DOMContentLoaded', init);

<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINE è²¼åœ– Prompt ç”¢ç”Ÿå™¨</title>
    <meta name="description" content="å¿«é€Ÿç”¢ç”Ÿ LINE è²¼åœ–çš„ AI åœ–åƒç”Ÿæˆ Promptï¼Œæ”¯æ´å¤šç¨®ä¸»é¡Œã€é¢¨æ ¼å’Œè§’è‰²æ¨¡æ¿">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1>ğŸ¨ LINE è²¼åœ– Prompt ç”¢ç”Ÿå™¨</h1>
            <p class="subtitle">å¿«é€Ÿç”¢ç”Ÿ AI ç¹ªåœ–æç¤ºè©</p>
            <nav class="header-nav">
                <a href="image-processor.html" class="btn btn-primary">ğŸ–¼ï¸ åœ–ç‰‡è™•ç†å™¨ â†’</a>
            </nav>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Left Panel: Settings -->
            <aside class="settings-panel">
                <!-- Character Template -->
                <section class="setting-group">
                    <h3 class="setting-title">
                        <span class="icon">ğŸ‘¤</span> è§’è‰²æ¨¡æ¿
                    </h3>
                    <select id="characterTemplate" class="select-input">
                        <!-- Populated by JS -->
                    </select>
                    <div id="characterCustom" class="custom-input-group hidden">
                        <textarea id="customCharacter" class="textarea-input" placeholder="è¼¸å…¥è‡ªè¨‚è§’è‰²æè¿°..."></textarea>
                    </div>

                    <!-- Character Reference Instruction -->
                    <div id="refImageInstruction" class="ref-instruction hidden">
                        <div class="instruction-content">
                            <span class="icon">ğŸ’¡</span>
                            <p>è«‹è¨˜å¾—åœ¨è²¼ä¸Š Prompt å¾Œï¼Œ<br><strong>æ‰‹å‹•é™„ä¸Šä½ çš„è§’è‰²åœ–ç‰‡</strong>çµ¦ AIã€‚</p>
                        </div>
                    </div>
                </section>

                <!-- Theme Selection -->
                <section class="setting-group">
                    <h3 class="setting-title">
                        <span class="icon">ğŸ­</span> ä¸»é¡Œ
                    </h3>
                    <select id="themeSelect" class="select-input">
                        <!-- Populated by JS -->
                    </select>
                </section>

                <!-- Style Selection -->
                <section class="setting-group">
                    <h3 class="setting-title">
                        <span class="icon">ğŸ¨</span> é¢¨æ ¼
                    </h3>
                    <select id="styleSelect" class="select-input">
                        <!-- Populated by JS -->
                    </select>
                    <div class="checkbox-row">
                        <label id="vectorArtOption" class="checkbox-label hidden">
                            <input type="checkbox" id="vectorArt" checked>
                            <span>âœ¨ å‘é‡å“è³ª</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="characterOutline" checked>
                            <span>ğŸ–¼ï¸ ç™½é‚Šææ¡†</span>
                        </label>
                    </div>
                </section>

                <!-- Text Settings -->
                <section class="setting-group">
                    <h3 class="setting-title">
                        <span class="icon">âœï¸</span> æ–‡å­—è¨­å®š
                    </h3>
                    <div class="sub-setting">
                        <label>é¢¨æ ¼</label>
                        <select id="textStyle" class="select-input select-small">
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    <div class="sub-setting">
                        <label>ä½ç½®</label>
                        <select id="textPosition" class="select-input select-small">
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    <div class="sub-setting">
                        <label>èªè¨€</label>
                        <select id="textLanguage" class="select-input select-small">
                            <!-- Populated by JS -->
                        </select>
                    </div>
                </section>

                <!-- Output Settings -->
                <section class="setting-group">
                    <h3 class="setting-title">
                        <span class="icon">ğŸ–¼ï¸</span> è¼¸å‡ºè¨­å®š
                    </h3>
                    <div class="output-row">
                        <div class="sub-setting">
                            <label>æ•¸é‡</label>
                            <select id="outputCount" class="select-input select-small">
                                <option value="1">1 å¼µ</option>
                                <option value="4">4 å¼µ</option>
                                <option value="6">6 å¼µ</option>
                                <option value="8">8 å¼µ</option>
                                <option value="9" selected>9 å¼µ</option>
                                <option value="12">12 å¼µ</option>
                                <option value="16">16 å¼µ</option>
                                <option value="20">20 å¼µ</option>
                                <option value="24">24 å¼µ</option>
                            </select>
                        </div>
                        <div class="sub-setting">
                            <label>èƒŒæ™¯</label>
                            <select id="bgColor" class="select-input select-small">
                                <option value="green" selected>ç¶ å¹•</option>
                                <option value="white">ç´”ç™½</option>
                                <option value="custom">è‡ªè¨‚</option>
                            </select>
                        </div>
                    </div>
                    <div id="customBgColor" class="sub-setting hidden">
                        <label>é¡è‰²</label>
                        <input type="color" id="bgColorPicker" value="#FFFFFF" class="color-picker">
                    </div>
                </section>

                <!-- Sticker Items -->
                <section class="setting-group sticker-items-group">
                    <h3 class="setting-title">
                        <span class="icon">ğŸ“‹</span> è²¼åœ–é …ç›®
                        <span class="item-count" id="itemCount">(6 é …)</span>
                    </h3>
                    <div id="stickerItems" class="sticker-items">
                        <!-- Populated by JS -->
                    </div>
                </section>
            </aside>

            <!-- Right Panel: Preview -->
            <section class="preview-panel">
                <div class="preview-header">
                    <h2>ğŸ“‹ Prompt é è¦½</h2>
                    <div class="preview-actions">
                        <button id="copyBtn" class="btn btn-primary">
                            <span class="btn-icon">ğŸ“‹</span> è¤‡è£½
                        </button>
                        <button id="resetBtn" class="btn btn-secondary">
                            <span class="btn-icon">ğŸ”„</span> é‡è¨­
                        </button>
                    </div>
                </div>
                <div class="preview-content">
                    <pre id="promptOutput" class="prompt-output"></pre>
                </div>
                <div class="preview-footer">
                    <span id="copyStatus" class="copy-status"></span>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="app-footer">
            <div class="footer-actions">
                <button id="saveSettingsBtn" class="btn btn-ghost">
                    <span class="btn-icon">ğŸ’¾</span> å„²å­˜è¨­å®š
                </button>
                <button id="loadSettingsBtn" class="btn btn-ghost">
                    <span class="btn-icon">ğŸ“‚</span> è¼‰å…¥è¨­å®š
                </button>
                <button id="clearSettingsBtn" class="btn btn-ghost">
                    <span class="btn-icon">ğŸ—‘ï¸</span> æ¸…é™¤è¨­å®š
                </button>
            </div>
        </footer>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden"></div>

    <script src="data.js"></script>
    <script src="app.js"></script>
</body>

</html>

/* =========================================
   LINE è²¼åœ– Prompt ç”¢ç”Ÿå™¨ - æ¨£å¼è¡¨
   ========================================= */

/* CSS Variables */
:root {
    /* Colors */
    --primary: #06C755;
    --primary-dark: #05a648;
    --primary-light: #e8f8ef;
    --secondary: #4a5568;
    --accent: #9f7aea;

    /* Neutrals */
    --bg-main: #f7fafc;
    --bg-card: #ffffff;
    --bg-input: #f8f9fa;
    --border: #e2e8f0;
    --border-focus: #06C755;

    /* Text */
    --text-primary: #1a202c;
    --text-secondary: #718096;
    --text-muted: #a0aec0;

    /* Shadows */
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);
    --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);

    /* Radius */
    --radius-sm: 6px;
    --radius-md: 10px;
    --radius-lg: 16px;

    /* Spacing */
    --gap: 16px;
}

/* Reset & Base */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, sans-serif;
    background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
    min-height: 100vh;
    color: var(--text-primary);
    line-height: 1.6;
}

/* App Container */
.app-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: var(--gap);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

/* Header */
.app-header {
    text-align: center;
    padding: 24px 0;
    margin-bottom: var(--gap);
}

.app-header h1 {
    font-size: 2rem;
    font-weight: 700;
    background: linear-gradient(135deg, var(--primary) 0%, #00b341 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 8px;
}

.app-header .subtitle {
    color: var(--text-secondary);
    font-size: 1rem;
}

/* Header Nav */
.header-nav {
    margin-top: 12px;
}

.nav-link {
    color: var(--primary);
    text-decoration: none;
    font-size: 0.95rem;
    transition: all 0.2s;
}

.nav-link:hover {
    opacity: 0.8;
}

.nav-link-highlight {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 8px 16px;
    border-radius: var(--radius-md);
    font-weight: 500;
}

.nav-link-highlight:hover {
    opacity: 0.9;
    transform: translateY(-1px);
}

/* Main Content Layout */
.main-content {
    display: grid;
    grid-template-columns: 380px 1fr;
    gap: var(--gap);
    flex: 1;
}

/* Settings Panel */
.settings-panel {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
    padding: 20px;
    height: fit-content;
    max-height: calc(100vh - 180px);
    overflow-y: auto;
    position: sticky;
    top: var(--gap);
}

.settings-panel::-webkit-scrollbar {
    width: 6px;
}

.settings-panel::-webkit-scrollbar-track {
    background: transparent;
}

.settings-panel::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 3px;
}

/* Setting Groups */
.setting-group {
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--border);
}

.setting-group:last-child {
    border-bottom: none;
    margin-bottom: 40px;
    padding-bottom: 40px;
}

.setting-title {
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.setting-title .icon {
    font-size: 1.1rem;
}

.setting-title .item-count {
    font-weight: 400;
    color: var(--text-muted);
    font-size: 0.85rem;
    margin-left: auto;
}

/* Form Elements */
.select-input {
    width: 100%;
    padding: 12px 14px;
    border: 2px solid var(--border);
    border-radius: var(--radius-md);
    font-size: 0.95rem;
    font-family: inherit;
    background: var(--bg-input);
    color: var(--text-primary);
    cursor: pointer;
    transition: all 0.2s ease;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23718096' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
}

.select-input:hover {
    border-color: var(--primary);
}

.select-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px var(--primary-light);
}

.select-small {
    padding: 8px 12px;
    font-size: 0.9rem;
}

.textarea-input {
    width: 100%;
    padding: 12px 14px;
    border: 2px solid var(--border);
    border-radius: var(--radius-md);
    font-size: 0.9rem;
    font-family: inherit;
    background: var(--bg-input);
    color: var(--text-primary);
    resize: vertical;
    min-height: 80px;
    transition: all 0.2s ease;
}

.textarea-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px var(--primary-light);
}

/* Sub Settings */
.sub-setting {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 10px;
}

/* Output Row for Quantity and Background side-by-side */
.output-row {
    display: flex;
    gap: 12px;
    margin-bottom: 10px;
}

.output-row .sub-setting {
    flex: 1;
    margin-bottom: 0;
    gap: 8px;
}

.output-row .sub-setting label {
    min-width: auto;
    white-space: nowrap;
}

.sub-setting:last-child {
    margin-bottom: 0;
}

.sub-setting label {
    min-width: 50px;
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.sub-setting .select-input {
    flex: 1;
}

/* Color Picker */
.color-picker {
    width: 60px;
    height: 36px;
    border: 2px solid var(--border);
    border-radius: var(--radius-sm);
    cursor: pointer;
    padding: 2px;
}

/* Checkbox Settings */
.checkbox-setting {
    margin-top: 12px;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.checkbox-label input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
    accent-color: var(--primary);
}

/* Checkbox Row - horizontal layout */
.checkbox-row {
    display: flex;
    gap: 16px;
    margin-top: 12px;
    flex-wrap: wrap;
}

/* Sticker Items */
.sticker-items {
    display: flex;
    flex-direction: column;
    gap: 8px;
    max-height: 500px;
    overflow-y: auto;
    padding-right: 4px;
}

.sticker-item {
    display: grid;
    grid-template-columns: 24px 1fr 1fr;
    gap: 8px;
    align-items: center;
    padding: 8px;
    background: var(--bg-input);
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
    transition: all 0.2s ease;
}

.sticker-item:hover {
    border-color: var(--primary);
}

.sticker-item .item-number {
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--text-muted);
    text-align: center;
}

.sticker-item input {
    padding: 6px 10px;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    font-size: 0.85rem;
    font-family: inherit;
    background: white;
    transition: all 0.2s ease;
}

.sticker-item input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 2px var(--primary-light);
}

.sticker-item input::placeholder {
    color: var(--text-muted);
}

/* Custom Input Group */
.custom-input-group {
    margin-top: 12px;
}

/* Reference Instruction */
.ref-instruction {
    margin-top: 12px;
    background: #fff3cd;
    border: 1px solid #ffeeba;
    color: #856404;
    padding: 12px;
    border-radius: var(--radius-md);
    font-size: 0.9rem;
    line-height: 1.5;
}

.instruction-content {
    display: flex;
    align-items: flex-start;
    gap: 8px;
}

.instruction-content .icon {
    font-size: 1.2rem;
}

.instruction-content p {
    margin: 0;
}

/* Preview Panel */
.preview-panel {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
    display: flex;
    flex-direction: column;
    min-height: 500px;
}

.preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
}

.preview-header h2 {
    font-size: 1.1rem;
    font-weight: 600;
}

.preview-actions {
    display: flex;
    gap: 8px;
}

.preview-content {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
}

.prompt-output {
    font-family: 'Consolas', 'Monaco', monospace;
    font-size: 0.9rem;
    line-height: 1.7;
    white-space: pre-wrap;
    word-break: break-word;
    color: var(--text-primary);
    background: var(--bg-input);
    padding: 16px;
    border-radius: var(--radius-md);
    border: 1px solid var(--border);
    min-height: 400px;
}

.preview-footer {
    padding: 12px 20px;
    border-top: 1px solid var(--border);
    text-align: center;
}

.copy-status {
    font-size: 0.85rem;
    color: var(--primary);
    font-weight: 500;
}

/* Buttons */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: 10px 18px;
    border: none;
    border-radius: var(--radius-md);
    font-size: 0.9rem;
    font-weight: 500;
    font-family: inherit;
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn-icon {
    font-size: 1rem;
}

.btn-primary {
    background: #d4f5e2;
    color: #1a5c34;
    border: 2px solid #06C755;
    box-shadow: 0 2px 6px rgba(6, 199, 85, 0.2);
    font-size: 1rem;
    font-weight: 600;
    text-decoration: none;
}

.btn-primary:hover {
    background: #b8eece;
    transform: translateY(-1px);
    box-shadow: 0 4px 10px rgba(6, 199, 85, 0.3);
}

.btn-secondary {
    background: var(--bg-input);
    color: var(--text-secondary);
    border: 1px solid var(--border);
}

.btn-secondary:hover {
    background: var(--border);
    color: var(--text-primary);
}

.btn-ghost {
    background: transparent;
    color: var(--text-secondary);
    padding: 8px 14px;
}

.btn-ghost:hover {
    background: var(--bg-input);
    color: var(--text-primary);
}

/* Footer */
.app-footer {
    padding: 16px 0;
    margin-top: var(--gap);
}

.footer-actions {
    display: flex;
    justify-content: center;
    gap: 12px;
}

/* Toast */
.toast {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--text-primary);
    color: white;
    padding: 14px 24px;
    border-radius: var(--radius-md);
    font-size: 0.9rem;
    font-weight: 500;
    box-shadow: var(--shadow-lg);
    z-index: 1000;
    opacity: 0;
    transition: all 0.3s ease;
}

.toast.show {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
}

.toast.success {
    background: var(--primary);
}

.toast.error {
    background: #e53e3e;
}

/* Utility Classes */
.hidden {
    display: none !important;
}

/* Responsive */
@media (max-width: 900px) {
    .main-content {
        grid-template-columns: 1fr;
    }

    .settings-panel {
        position: static;
        max-height: none;
    }

    .app-header h1 {
        font-size: 1.6rem;
    }
}

@media (max-width: 480px) {
    .app-container {
        padding: 12px;
    }

    .settings-panel,
    .preview-panel {
        padding: 16px;
    }

    .preview-actions {
        flex-direction: column;
    }

    .sticker-item {
        grid-template-columns: 20px 1fr;
    }

    .sticker-item input:last-child {
        grid-column: 2;
    }
}



